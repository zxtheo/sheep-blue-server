from flask import Flask, request
from flask_cors import CORS
import csv
  
app = Flask(__name__) 
CORS(app)

test = {'datetime': '28/01/2021_18:21:58_test', 'csv': [[299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 
0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 
0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 
0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 
100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 
0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 
0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 
0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 
0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 
0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 
100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0], [299, 506, 0, 0, 100, 100, 84, 232, 262, 0, 0, 0]]}

@app.route("/") 
def home_view(): 
    return "<h1>you are not in the right place...</h1>"

@app.route("/postdata", methods=["POST"])
def post_data():
    if request.is_json:

        # Parse the JSON into a Python dictionary
        req = request.get_json()
       

        # Print the dictionary
        print(req)
        save_csv(req)
        # Return a string along with an HTTP status code
        return "JSON received!", 200

    else:

        # The request body wasn't JSON so return a 400 HTTP status code
        return "Request was not JSON", 400

def save_csv(json):
    csv_data = json['csv']
    file_name = json['datetime'].replace('/','-').replace(':', '-')
    #csv = [",".join("'{0}'".format(n) for n in row) for row in csv]
    print(csv_data)
    with open("{}.csv".format(file_name), mode='w', newline='') as csv_file:
        writer = csv.writer(csv_file, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL )
        for row in csv_data:
            writer.writerow(row)

save_csv(test)
